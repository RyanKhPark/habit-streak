import React, { useEffect } from "react";
import { Dimensions, StyleSheet } from "react-native";
import Animated, {
  Easing,
  interpolate,
  useAnimatedStyle,
  useSharedValue,
  withSequence,
  withTiming,
} from "react-native-reanimated";
import Svg, {
  ClipPath,
  Defs,
  G,
  LinearGradient,
  Path,
  Stop,
} from "react-native-svg";
import { useTimeBasedTheme } from "../hooks/useTimeBasedTheme";

const { width } = Dimensions.get("window");

interface SplashAnimationProps {
  onAnimationComplete: () => void;
}

export default function SplashAnimation({
  onAnimationComplete,
}: SplashAnimationProps) {
  const opacity = useSharedValue(0);

  useEffect(() => {
    // Fade in, hold, then fade out
    opacity.value = withTiming(
      1,
      { duration: 800, easing: Easing.out(Easing.cubic) },
      () => {
        opacity.value = withSequence(
          withTiming(1, { duration: 1000 }), // hold for 1 second
          withTiming(
            0,
            { duration: 600, easing: Easing.in(Easing.cubic) },
            (finished) => {
              if (finished && onAnimationComplete) {
                setTimeout(onAnimationComplete, 100);
              }
            }
          )
        );
      }
    );

    // Fallback timer
    const fallbackTimer = setTimeout(() => {
      onAnimationComplete();
    }, 2600);

    return () => clearTimeout(fallbackTimer);
  }, [onAnimationComplete]);

  const logoStyle = useAnimatedStyle(() => ({
    opacity: opacity.value,
    transform: [{ scale: interpolate(opacity.value, [0, 1], [0.8, 1]) }],
  }));

  const theme = useTimeBasedTheme();

  const baseW = width * 0.4;
  const baseH = (baseW * 30) / 45;

  return (
    <Animated.View
      style={[styles.container, { backgroundColor: theme.gradientColors[0] }]}
    >
      <Animated.View style={[logoStyle, styles.center]}>
        <Svg width={baseW} height={baseH} viewBox="0 0 45 30">
          <Defs>
            <ClipPath
              id="bgblur_0_59_5060_clip_path"
              // transform="translate(4.68066 4.81445)"
            >
              <Path
                fillRule="evenodd"
                clipRule="evenodd"
                d="M40.8147 3.80381C44.5442 8.07124 41.8974 14.8157 36.8887 16.2147C33.8951 17.0508 30.1895 17.0872 27.5145 17.0919C27.5935 18.8304 28.0677 20.1265 28.937 20.98C29.8063 21.8176 31.1024 22.2365 32.8251 22.2365C33.4572 22.2365 34.058 22.1574 34.6269 21.9994C35.2116 21.8256 35.8756 21.541 36.6184 21.1459C36.8238 21.0353 37.1242 20.8535 37.5193 20.6006C38.91 19.7156 40.0798 19.273 41.028 19.273C41.9604 19.273 42.7272 19.5496 43.3277 20.1028C43.9282 20.6401 44.2286 21.3357 44.2286 22.1891C44.2286 23.9592 43.0905 25.4845 40.8147 26.7647C38.5546 28.0449 35.7727 28.685 32.4695 28.6851C30.1778 28.6851 28.1546 28.2978 26.4002 27.5234C24.6459 26.7489 23.2866 25.6504 22.3225 24.228C21.2003 25.7294 19.7461 26.8516 17.9602 27.5945C16.1901 28.3215 14.0404 28.685 11.5116 28.6851C6.01781 28.6851 0.819336 26.6771 0.819336 20.4347C0.819336 14.2452 6.37651 12.7628 11.5827 12.1843C12.0727 12.1211 12.7367 12.05 13.5742 11.971C17.2725 11.5916 19.3285 10.7179 19.3285 9.35866C19.3285 8.64749 19.1813 8.13712 18.5966 7.7736C18.0118 7.3943 17.1668 7.21174 15.6004 7.54747C8.46137 9.07761 7.25164 6.87974 7.01716 5.13422C6.78269 3.38869 7.99804 2.04833 9.61726 1.45736C10.9161 0.983303 12.8497 0.748584 15.6004 0.748584C17.5128 0.748606 19.201 1.27868 20.5918 1.80024C21.9984 2.32182 23.2076 3.14374 24.2191 4.26586C25.3412 3.17536 26.582 2.36131 27.9412 1.82394C32.6554 -0.0182528 37.3315 0.19323 40.8147 3.80381ZM19.027 16.2147C18.4581 16.4833 17.8337 16.7126 17.1541 16.9022C16.4903 17.076 15.6446 17.2499 14.6174 17.4238C13.2424 17.645 11.7739 18.0161 11.2681 18.4112C10.7781 18.7905 10.5331 19.3516 10.5331 20.0945C10.5331 23.3517 16.2133 22.9876 17.8891 21.3119C18.6793 20.5216 19.0745 19.2413 19.0745 17.4712C19.0745 17.1393 19.0666 16.8864 19.0508 16.7125C19.0508 16.5229 19.0429 16.3569 19.027 16.2147ZM28.7159 8.65314C27.9415 9.49082 27.5461 10.4062 27.4671 11.9235C27.4671 11.9235 33.984 13.2365 35.1494 11.2804C36.3148 9.32419 34.9568 8.12029 34.2346 7.69757C32.557 6.71554 30.127 7.15756 28.7159 8.65314Z"
              />
            </ClipPath>
            <LinearGradient
              id="paint0_linear_59_5060"
              x1="22.524"
              y1="0.685059"
              x2="39.2024"
              y2="28.6851"
              gradientUnits="userSpaceOnUse"
            >
              <Stop stopColor="#4F46E5" />
              <Stop offset="1" stopColor="#8B5CF6" />
            </LinearGradient>
            <LinearGradient
              id="paint1_linear_59_5060"
              x1="22.524"
              y1="0.685059"
              x2="22.524"
              y2="28.6851"
              gradientUnits="userSpaceOnUse"
            >
              <Stop stopColor="white" />
              <Stop offset="1" stopColor="white" />
            </LinearGradient>
          </Defs>
          <G>
            <Path
              fillRule="evenodd"
              clipRule="evenodd"
              d="M40.8147 3.80381C44.5442 8.07124 41.8974 14.8157 36.8887 16.2147C33.8951 17.0508 30.1895 17.0872 27.5145 17.0919C27.5935 18.8304 28.0677 20.1265 28.937 20.98C29.8063 21.8176 31.1024 22.2365 32.8251 22.2365C33.4572 22.2365 34.058 22.1574 34.6269 21.9994C35.2116 21.8256 35.8756 21.541 36.6184 21.1459C36.8238 21.0353 37.1242 20.8535 37.5193 20.6006C38.91 19.7156 40.0798 19.273 41.028 19.273C41.9604 19.273 42.7272 19.5496 43.3277 20.1028C43.9282 20.6401 44.2286 21.3357 44.2286 22.1891C44.2286 23.9592 43.0905 25.4845 40.8147 26.7647C38.5546 28.0449 35.7727 28.685 32.4695 28.6851C30.1778 28.6851 28.1546 28.2978 26.4002 27.5234C24.6459 26.7489 23.2866 25.6504 22.3225 24.228C21.2003 25.7294 19.7461 26.8516 17.9602 27.5945C16.1901 28.3215 14.0404 28.685 11.5116 28.6851C6.01781 28.6851 0.819336 26.6771 0.819336 20.4347C0.819336 14.2452 6.37651 12.7628 11.5827 12.1843C12.0727 12.1211 12.7367 12.05 13.5742 11.971C17.2725 11.5916 19.3285 10.7179 19.3285 9.35866C19.3285 8.64749 19.1813 8.13712 18.5966 7.7736C18.0118 7.3943 17.1668 7.21174 15.6004 7.54747C8.46137 9.07761 7.25164 6.87974 7.01716 5.13422C6.78269 3.38869 7.99804 2.04833 9.61726 1.45736C10.9161 0.983303 12.8497 0.748584 15.6004 0.748584C17.5128 0.748606 19.201 1.27868 20.5918 1.80024C21.9984 2.32182 23.2076 3.14374 24.2191 4.26586C25.3412 3.17536 26.582 2.36131 27.9412 1.82394C32.6554 -0.0182528 37.3315 0.19323 40.8147 3.80381ZM19.027 16.2147C18.4581 16.4833 17.8337 16.7126 17.1541 16.9022C16.4903 17.076 15.6446 17.2499 14.6174 17.4238C13.2424 17.645 11.7739 18.0161 11.2681 18.4112C10.7781 18.7905 10.5331 19.3516 10.5331 20.0945C10.5331 23.3517 16.2133 22.9876 17.8891 21.3119C18.6793 20.5216 19.0745 19.2413 19.0745 17.4712C19.0745 17.1393 19.0666 16.8864 19.0508 16.7125C19.0508 16.5229 19.0429 16.3569 19.027 16.2147ZM28.7159 8.65314C27.9415 9.49082 27.5461 10.4062 27.4671 11.9235C27.4671 11.9235 33.984 13.2365 35.1494 11.2804C36.3148 9.32419 34.9568 8.12029 34.2346 7.69757C32.557 6.71554 30.127 7.15756 28.7159 8.65314Z"
              fill="url(#paint0_linear_59_5060)"
              fillOpacity={0.2}
            />
            <Path
              d="M27.8506 1.59131C32.473 -0.214994 37.1177 -0.0876224 40.6553 3.29248L40.9941 3.63037L41.0029 3.63916L41.1797 3.84814C42.9522 6.02825 43.1846 8.7785 42.3652 11.1665C41.5207 13.6276 39.55 15.731 36.9561 16.4556C34.0231 17.2748 30.4274 17.3331 27.7793 17.3403C27.8903 18.9082 28.346 20.0488 29.1123 20.8013H29.1113C29.9173 21.5772 31.1403 21.9868 32.8252 21.9868C33.4361 21.9868 34.0141 21.9098 34.5596 21.7583C34.9815 21.6325 35.4505 21.4462 35.9668 21.1968L36.501 20.9253C36.6978 20.8192 36.9916 20.6417 37.3848 20.3901L37.9033 20.0747C39.0917 19.3853 40.1364 19.0229 41.0283 19.0229C42.0137 19.0231 42.8439 19.3169 43.4971 19.9185H43.4961C44.1517 20.5061 44.4785 21.2701 44.4785 22.189C44.4785 24.0884 43.2509 25.6816 40.9375 26.9829L40.9365 26.9819C38.7743 28.2065 36.1553 28.8514 33.0889 28.9272L32.4697 28.9351C30.1499 28.9351 28.0906 28.5433 26.2988 27.7524C24.6222 27.0122 23.2906 25.9774 22.3125 24.647C21.193 26.0504 19.7738 27.1114 18.0566 27.8257H18.0547C16.3594 28.5219 14.3342 28.8882 11.9854 28.9312L11.5117 28.9351C8.74118 28.9351 6.01303 28.4299 3.96973 27.1108C1.9104 25.7814 0.569439 23.6389 0.569336 20.4351C0.569336 18.849 0.925832 17.5505 1.55371 16.4888C2.18128 15.4277 3.07249 14.6161 4.12109 13.9907C6.20907 12.7457 8.94401 12.2259 11.5508 11.936L12.4219 11.8354C12.7547 11.7998 13.1304 11.7617 13.5488 11.7222L14.2188 11.646C15.7334 11.4545 16.9137 11.1713 17.7363 10.8042C18.6857 10.3805 19.078 9.8854 19.0781 9.35889C19.0781 9.01736 19.0424 8.75019 18.9512 8.53271C18.8629 8.32226 18.7165 8.14234 18.4648 7.98584L18.4609 7.98291C17.9528 7.65332 17.1831 7.46341 15.6523 7.7915C12.0683 8.55964 9.9136 8.4076 8.61328 7.79541C7.28425 7.16962 6.89319 6.08803 6.76953 5.16748C6.51379 3.2636 7.84737 1.83679 9.53125 1.22217C10.8726 0.732593 12.8427 0.498535 15.6006 0.498535C17.5582 0.498588 19.2802 1.0411 20.6797 1.56592H20.6787C22.044 2.07219 23.2289 2.85493 24.2314 3.91162C25.3268 2.88772 26.5323 2.11212 27.8496 1.59131H27.8506ZM18.7979 16.5894C18.3078 16.8002 17.783 16.9864 17.2217 17.1431L17.2178 17.144C16.5442 17.3204 15.6904 17.4959 14.6592 17.6704H14.6572C13.9766 17.7799 13.2753 17.9267 12.6846 18.0933C12.0813 18.2634 11.6318 18.444 11.4219 18.6079L11.4209 18.6089C11.0046 18.9312 10.7833 19.4117 10.7832 20.0942C10.7832 20.8231 11.0952 21.3374 11.5918 21.6909C12.0994 22.0522 12.8109 22.2516 13.5986 22.3032C14.3833 22.3546 15.222 22.2577 15.9639 22.0464C16.7101 21.8338 17.3345 21.5125 17.7119 21.1353C18.4341 20.413 18.8242 19.2124 18.8242 17.4712C18.8242 17.1414 18.8165 16.8972 18.8018 16.7349L18.8008 16.7241V16.7124C18.8008 16.6699 18.7987 16.629 18.7979 16.5894ZM34.1084 7.91357C32.5433 6.99743 30.2393 7.40241 28.8984 8.82178L28.8994 8.82275C28.2073 9.57138 27.8321 10.3819 27.7305 11.7183C27.7501 11.7218 27.7709 11.7261 27.793 11.73C27.9713 11.7617 28.2283 11.8052 28.54 11.8511C29.1642 11.9429 30.0064 12.0441 30.8828 12.0854C31.7619 12.1269 32.6629 12.1068 33.4092 11.9604C34.1684 11.8115 34.7005 11.5454 34.9346 11.1528C35.4779 10.2408 35.4194 9.53829 35.1738 9.021C34.9196 8.48574 34.4466 8.11158 34.1084 7.91357Z"
              stroke="url(#paint1_linear_59_5060)"
              strokeOpacity={0.4}
              strokeWidth={0.5}
            />
          </G>
        </Svg>
      </Animated.View>
    </Animated.View>
  );
}

const styles = StyleSheet.create({
  container: {
    flex: 1,
    justifyContent: "center",
    alignItems: "center",
    position: "absolute",
    top: 0,
    left: 0,
    right: 0,
    bottom: 0,
  },
  center: { alignItems: "center", justifyContent: "center" },
});
